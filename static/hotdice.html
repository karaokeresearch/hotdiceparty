<!doctype html>

<html lang="en">
<head>
    <script src="jquery-3.5.0.min.js"></script>
    <script src="hotdice.js"></script>
    <meta charset="utf-8">

  <title>Hot Dice UI demo</title>
  
  <link rel="stylesheet" href="styles.css?v=1.0">

</head>

<body>

<div id="console">0 ❌</div>    
    
<script>

    
var totalDice=6;
var outcome;
var currentRoll=[];
var diceEval=[]; //dice currently being evaluated
var evalPitSpaces=["empty","empty","empty","empty","empty","empty"]; //spaces in the eval pit for moving dice for evaluation

var lowestOpenPitSpot=function(){
    for (var i=0; i<6; i++){
        if(evalPitSpaces[i]=="empty"){
            
             break;
        }
    }
return(i);
}

var removeFromPit=function(whichDice){
    for (var i=0; i<6; i++){
        if(evalPitSpaces[i]==whichDice){
        evalPitSpaces[i]="empty";
        }
    }
}



var diceAnimate=function(diceNum,outcome,iteration){
    if (iteration==undefined){iteration=0}
    //console.log(iteration);
    if (iteration==7){
        $("#d"+ diceNum).html(diceUnicode[outcome])
    }
    else{
    iteration++;
    $("#d"+ diceNum).html(diceUnicode[rollDice()]);
    
    (function(diceNum, outcome, iteration){
        setTimeout(function(){
        diceAnimate(diceNum, outcome, iteration)
        },30);
    }(diceNum, outcome, iteration));
        
    }
    
}    

var beingEvaluated=function(diceNum){
    var toReturn=false;
    for (var i=0; i<diceEval.length; i++)   {
        if (diceEval[i]==diceNum){toReturn=true;}
    }
    return toReturn;
}
        
$( document ).ready(function() {
    for (var i=0; i<totalDice; i++){
        outcome=rollDice();
        currentRoll.push(outcome);
        $("#diceholder").append('<div id="d' + i+ '"class="dice" style="left:' + (40+ (i*15)) + 'vh">' +  '</div>');
        
        
        (function(i,outcome){
            setTimeout(function(){
                console.log(i,outcome);    
                diceAnimate(i,outcome);
            },i*100);
        }(i,outcome));

    }
    console.log(currentRoll);
    
    $( ".dice" ).on( "click", function() {
        var whichDice=parseInt(($( this ).attr('id').substring(1)));
        console.log("dice " + whichDice + ": " + currentRoll[whichDice]);
        
        if(diceEval.includes(whichDice)==false ){ //is it not in the eval pit?
            diceEval.push(whichDice);
            var openSlot=lowestOpenPitSpot();
            evalPitSpaces[openSlot]=whichDice;
            $( this ).animate({left:(5 + (openSlot *15)) + "vh",top: "80vh"},300);
            
        }else{                              //it's already in the eval pit
            diceEval = diceEval.filter(dice => dice!=whichDice);
            removeFromPit(whichDice);
            $( this ).animate({left: (40+ (whichDice*15)) +"vh", top: "40vh"},300);
        }
        
        var evalValues=[];
        for (var i=0; i<6; i++){
            if (diceEval.includes(i)){
            evalValues.push(currentRoll[i])    
            }
        }
        console.log(evalValues);
        var evalResults=evalPoints(evalValues);
        //console.log(evalResults);
        var scoring='❌';
        if (evalResults.scoringDice==evalValues.length && evalValues.length>0){
           scoring='✅'; 
        }
        $("#console").html(evalResults.points + " " + scoring );
    });
    
    
    
})
    
    
</script>
<div id="diceholder">
    
</div>
</body>
</html>